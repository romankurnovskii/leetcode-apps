name: PR JSON Validation

on:
  pull_request:
    paths:
      - "data/leetcode-problems.json"
      - "scripts/normalize_json.py"
    branches:
      - main

jobs:
  validate-json:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Validate JSON syntax and structure
        run: |
          python3 << 'EOF'
          import json
          import sys

          # Validate JSON syntax
          try:
              with open('data/leetcode-problems.json', 'r') as f:
                  data = json.load(f)
          except json.JSONDecodeError as e:
              print(f"❌ Error: Invalid JSON syntax - {e}")
              sys.exit(1)

          # Check if root is a dict
          if not isinstance(data, dict):
              print("❌ Error: Root must be a dictionary")
              sys.exit(1)

          # Check if all keys are numeric strings
          for key in data.keys():
              try:
                  int(key)
              except ValueError:
                  print(f"❌ Error: Key '{key}' is not a numeric string")
                  sys.exit(1)

          print(f"✓ JSON syntax is valid")
          print(f"✓ JSON structure is valid ({len(data)} entries)")
          print(f"✓ All keys are numeric strings")
          EOF
